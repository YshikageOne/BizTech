const fs = require("fs");
const path = require("path");

const ordersDir = path.join(__dirname, "../app/customer/orders");
const outFile = path.join(__dirname, "../app/customer/orders-data.ts");

//loop through all .txt files
const files = fs
  .readdirSync(ordersDir)
  .filter((f) => f.endsWith(".txt"));

const data = files.reduce((acc, file) => {
  const id = path.basename(file, ".txt");         
  const raw = fs.readFileSync(path.join(ordersDir, file), "utf-8");
  let parsed;
  try {
    parsed = JSON.parse(raw);                      
  } catch {
    const lines = raw.split(/\r?\n/).filter(Boolean);
    parsed = lines.map(line => {
      const [dateStr, amtStr] = line.split(',').map(s => s.trim());
      return { date: dateStr, amount: parseFloat(amtStr) };
    });
  }
  acc[id] = parsed;
  return acc;
}, {});

const header = `/**
 * This file is auto-generated by scripts/generate-orders-data.js
 * Run: node scripts/generate-orders-data.js
 */

`;
const body = `export const ordersData: Record<string, any> = ${JSON.stringify(
  data,
  null,
  2
)};\n`;

fs.writeFileSync(outFile, header + body, "utf-8");
console.log("orders-data.ts generated.");